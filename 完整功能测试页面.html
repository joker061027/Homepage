<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°å­—é¤ç¥¨ç®¡ç†ç³»ç»Ÿ - å®Œæ•´åŠŸèƒ½æµ‹è¯•</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .nav-tabs { display: flex; background: #f8f9fa; border-bottom: 2px solid #dee2e6; }
        .nav-tab { flex: 1; padding: 15px; text-align: center; cursor: pointer; border: none; background: transparent; font-weight: 600; transition: all 0.3s; }
        .nav-tab.active { background: white; border-bottom: 3px solid #007bff; color: #007bff; }
        .nav-tab:hover { background: #e9ecef; }
        .content { padding: 30px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .function-group { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 8px; overflow: hidden; }
        .group-header { background: #f8f9fa; padding: 15px; border-bottom: 1px solid #dee2e6; font-weight: 600; color: #495057; }
        .group-body { padding: 20px; }
        .test-item { margin-bottom: 20px; padding: 15px; border: 1px solid #e9ecef; border-radius: 5px; background: #fafafa; }
        .test-item h4 { margin-bottom: 10px; color: #495057; }
        .form-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; flex-wrap: wrap; }
        .form-row label { min-width: 80px; font-weight: 600; color: #6c757d; }
        .form-row input, .form-row select, .form-row textarea { flex: 1; min-width: 200px; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; }
        .form-row textarea { min-height: 60px; resize: vertical; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; transition: all 0.3s; margin: 2px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .response-area { margin-top: 10px; padding: 10px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; font-family: monospace; font-size: 12px; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .success { border-color: #28a745; background: #d4edda; color: #155724; }
        .error { border-color: #dc3545; background: #f8d7da; color: #721c24; }
        .loading { border-color: #ffc107; background: #fff3cd; color: #856404; }
        .api-info { background: #e3f2fd; padding: 10px; border-radius: 4px; margin-bottom: 10px; font-size: 12px; }
        .api-info code { background: #1976d2; color: white; padding: 2px 4px; border-radius: 2px; }
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-loading { background: #ffc107; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .quick-actions { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .data-table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        .data-table th, .data-table td { padding: 8px; border: 1px solid #dee2e6; text-align: left; }
        .data-table th { background: #f8f9fa; font-weight: 600; }
        .json-viewer { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 12px; overflow-x: auto; }
        .order-item { display: flex; align-items: center; margin: 5px 0; padding: 8px; background: #e8f5e8; border-radius: 5px; border-left: 4px solid #28a745; }
        .order-item-text { flex: 1; font-weight: 600; color: #155724; }
        .btn-small { padding: 4px 8px; font-size: 12px; margin-left: 8px; }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>ğŸ« æ•°å­—é¤ç¥¨ç®¡ç†ç³»ç»Ÿ</h1>
                <p>å®Œæ•´åŠŸèƒ½æµ‹è¯•å¹³å° - CRUDæ“ä½œæµ‹è¯•</p>
            </div>
            
            <div class="nav-tabs">
                <button class="nav-tab active" @click="activeTab = 'users'">ğŸ‘¤ ç”¨æˆ·ç®¡ç†</button>
                <button class="nav-tab" @click="activeTab = 'orders'">ğŸ“‹ è®¢å•ç®¡ç†</button>
                <button class="nav-tab" @click="activeTab = 'tickets'">ğŸ« é¤ç¥¨ç®¡ç†</button>
                <button class="nav-tab" @click="activeTab = 'agencies'">ğŸ¢ éƒ¨é—¨ç®¡ç†</button>
                <button class="nav-tab" @click="activeTab = 'canteen'">ğŸ½ï¸ é£Ÿå ‚ç®¡ç†</button>
                <button class="nav-tab" @click="activeTab = 'system'">âš™ï¸ ç³»ç»ŸåŠŸèƒ½</button>
            </div>
            
            <div class="content">
                <!-- ç”¨æˆ·ç®¡ç† -->
                <div class="tab-content" :class="{active: activeTab === 'users'}">
                    <div class="quick-actions">
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-info" @click="loadAllUsers">ğŸ“‹ åŠ è½½æ‰€æœ‰ç”¨æˆ·</button>
                            <br><small style="color: #666;">GET /api/users</small>
                        </div>
                        <div style="display: inline-block;">
                            <button class="btn btn-success" @click="clearForm('user')">ğŸ†• æ–°å»ºç”¨æˆ·</button>
                            <br><small style="color: #666;">æ¸…ç©ºè¡¨å•</small>
                        </div>
                    </div>

                    <!-- ç”¨æˆ·é€‰æ‹©åŒºåŸŸ -->
                    <div class="function-group">
                        <div class="group-header">ğŸ” ç”¨æˆ·é€‰æ‹©æ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>é€‰æ‹©ç”¨æˆ·è¿›è¡Œæ“ä½œ</h4>
                                <div class="form-row">
                                    <label>é€‰æ‹©ç”¨æˆ·:</label>
                                    <select v-model="selectedUserId" @change="onUserSelect" style="width: 200px;">
                                        <option value="">-- è¯·é€‰æ‹©ç”¨æˆ· --</option>
                                        <option v-for="user in userList" :key="user.userId" :value="user.userId">
                                            {{user.userId}} - {{user.fullName}} ({{user.userName}})
                                        </option>
                                    </select>
                                    <button class="btn btn-secondary" @click="refreshUserList" style="margin-left: 10px;">
                                        ğŸ”„ åˆ·æ–°åˆ—è¡¨
                                    </button>
                                </div>
                                <div class="form-row" v-if="selectedUserId">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="getUserBySelectedId">
                                            <span class="status-indicator" :class="getStatusClass('getUser')"></span>
                                            æŸ¥è¯¢é€‰ä¸­ç”¨æˆ·
                                        </button>
                                        <br><small style="color: #666;">GET /api/users/{{selectedUserId}}</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-danger" @click="deleteSelectedUser">
                                            <span class="status-indicator" :class="getStatusClass('deleteUser')"></span>
                                            åˆ é™¤é€‰ä¸­ç”¨æˆ·
                                        </button>
                                        <br><small style="color: #666;">DELETE /api/users/{{selectedUserId}}</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-info" @click="getSelectedUserStatistics">
                                            <span class="status-indicator" :class="getStatusClass('userStats')"></span>
                                            é€‰ä¸­ç”¨æˆ·ç»Ÿè®¡
                                        </button>
                                        <br><small style="color: #666;">GET /api/users/{{selectedUserId}}/statistics</small>
                                    </div>
                                </div>
                                <div v-if="selectedUserId" style="margin-top: 10px; padding: 10px; background: #f0f8ff; border-radius: 4px;">
                                    <strong>å½“å‰é€‰ä¸­:</strong> {{selectedUserId}}
                                    <span v-if="selectedUserInfo"> - {{selectedUserInfo.fullName}} ({{selectedUserInfo.userName}})</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="function-group">
                        <div class="group-header">ğŸ‘¤ ç”¨æˆ·CRUDæ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>ç”¨æˆ·ä¿¡æ¯è¡¨å•</h4>
                                <div class="form-row">
                                    <label>ç”¨æˆ·ID:</label>
                                    <input v-model="userForm.userId" placeholder="USER001" />
                                    <label>ç”¨æˆ·å:</label>
                                    <input v-model="userForm.userName" placeholder="admin" />
                                </div>
                                <div class="form-row">
                                    <label>è§’è‰²ID:</label>
                                    <input v-model="userForm.roleId" placeholder="ROLE001" />
                                    <label>éƒ¨é—¨ID:</label>
                                    <input v-model="userForm.agenciesId" placeholder="DEPT001" />
                                </div>
                                <div class="form-row">
                                    <label>å§“å:</label>
                                    <input v-model="userForm.fullName" placeholder="å¼ ä¸‰" />
                                    <label>å¯†ç :</label>
                                    <input v-model="userForm.password" type="password" placeholder="123456" />
                                </div>
                                <div class="form-row">
                                    <label>çŠ¶æ€:</label>
                                    <select v-model="userForm.status">
                                        <option value="1">å¯ç”¨</option>
                                        <option value="0">ç¦ç”¨</option>
                                    </select>
                                    <label>æ‰‹æœºå·:</label>
                                    <input v-model="userForm.phoneNumber" placeholder="13800138000" />
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="createUser">
                                            <span class="status-indicator" :class="getStatusClass('createUser')"></span>
                                            åˆ›å»ºç”¨æˆ·
                                        </button>
                                        <br><small style="color: #666;">POST /api/users</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="getUserById">
                                            <span class="status-indicator" :class="getStatusClass('getUser')"></span>
                                            æŸ¥è¯¢ç”¨æˆ·
                                        </button>
                                        <br><small style="color: #666;">GET /api/users/{id}</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-danger" @click="deleteUser">
                                            <span class="status-indicator" :class="getStatusClass('deleteUser')"></span>
                                            åˆ é™¤ç”¨æˆ·
                                        </button>
                                        <br><small style="color: #666;">DELETE /api/users/{id}</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-info" @click="getUserStatistics">
                                            <span class="status-indicator" :class="getStatusClass('userStats')"></span>
                                            ç”¨æˆ·ç»Ÿè®¡
                                        </button>
                                        <br><small style="color: #666;">GET /api/users/{id}/statistics</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('userOperation')" v-if="responses.userOperation">
                                    {{ responses.userOperation }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- è®¢å•ç®¡ç† -->
                <div class="tab-content" :class="{active: activeTab === 'orders'}">
                    <div class="quick-actions">
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-info" @click="loadAllOrders">ğŸ“‹ åŠ è½½æ‰€æœ‰è®¢å•</button>
                            <br><small style="color: #666;">GET /api/orders</small>
                        </div>
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-primary" @click="loadOrdersWithPagination">ğŸ“„ åˆ†é¡µæŸ¥è¯¢è®¢å•</button>
                            <br><small style="color: #666;">GET /api/orders/page</small>
                        </div>
                        <div style="display: inline-block;">
                            <button class="btn btn-success" @click="clearForm('order')">ğŸ†• æ–°å»ºè®¢å•</button>
                            <br><small style="color: #666;">æ¸…ç©ºè¡¨å•</small>
                        </div>
                    </div>

                    <!-- åˆ†é¡µæŸ¥è¯¢åŒºåŸŸ -->
                    <div class="function-group">
                        <div class="group-header">ğŸ“„ åˆ†é¡µæŸ¥è¯¢åŠŸèƒ½</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>è®¢å•åˆ†é¡µæŸ¥è¯¢</h4>
                                <div class="form-row">
                                    <label>é¡µç :</label>
                                    <input v-model.number="orderPagination.page" type="number" min="0" placeholder="0" style="width: 80px;" />
                                    <label>æ¯é¡µå¤§å°:</label>
                                    <select v-model.number="orderPagination.size" style="width: 100px;">
                                        <option value="5">5æ¡</option>
                                        <option value="10">10æ¡</option>
                                        <option value="20">20æ¡</option>
                                        <option value="50">50æ¡</option>
                                    </select>
                                    <label>æ’åºå­—æ®µ:</label>
                                    <select v-model="orderPagination.sortBy" style="width: 150px;">
                                        <option value="createDatetime">åˆ›å»ºæ—¶é—´</option>
                                        <option value="orderId">è®¢å•ID</option>
                                        <option value="orderNumber">è®¢å•å·</option>
                                        <option value="status">çŠ¶æ€</option>
                                    </select>
                                    <label>æ’åºæ–¹å‘:</label>
                                    <select v-model="orderPagination.sortDir" style="width: 100px;">
                                        <option value="desc">é™åº</option>
                                        <option value="asc">å‡åº</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label>æŸ¥è¯¢ç”¨æˆ·ID:</label>
                                    <input v-model="orderForm.userId" placeholder="USER001" style="width: 120px;" />
                                    <label>æŸ¥è¯¢çŠ¶æ€:</label>
                                    <select v-model.number="orderQuery.status" style="width: 120px;">
                                        <option value="0">å¾…å®¡æ ¸</option>
                                        <option value="1">å·²é€šè¿‡</option>
                                        <option value="-1">å·²æ‹’ç»</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="loadOrdersWithPagination">
                                            <span class="status-indicator" :class="getStatusClass('orderPagination')"></span>
                                            åˆ†é¡µæŸ¥è¯¢
                                        </button>
                                        <br><small style="color: #666;">GET /api/orders/page?page={{orderPagination.page}}&size={{orderPagination.size}}</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-info" @click="loadOrdersByUserWithPagination">
                                            <span class="status-indicator" :class="getStatusClass('orderUserPagination')"></span>
                                            æŒ‰ç”¨æˆ·åˆ†é¡µæŸ¥è¯¢
                                        </button>
                                        <br><small style="color: #666;">GET /api/orders/page/user/{{orderForm.userId}}</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-warning" @click="loadOrdersByStatusWithPagination">
                                            <span class="status-indicator" :class="getStatusClass('orderStatusPagination')"></span>
                                            æŒ‰çŠ¶æ€åˆ†é¡µæŸ¥è¯¢
                                        </button>
                                        <br><small style="color: #666;">GET /api/orders/page/status/{{orderQuery.status}}</small>
                                    </div>
                                </div>
                                <div v-if="orderPaginationResult" style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 4px;">
                                    <strong>åˆ†é¡µä¿¡æ¯:</strong>
                                    ç¬¬{{orderPaginationResult.page + 1}}é¡µ / å…±{{orderPaginationResult.totalPages}}é¡µ |
                                    æ¯é¡µ{{orderPaginationResult.size}}æ¡ / æ€»è®¡{{orderPaginationResult.totalElements}}æ¡ |
                                    <button class="btn btn-small" @click="previousPage" :disabled="orderPaginationResult.first">ä¸Šä¸€é¡µ</button>
                                    <button class="btn btn-small" @click="nextPage" :disabled="orderPaginationResult.last">ä¸‹ä¸€é¡µ</button>
                                </div>

                                <!-- åˆ†é¡µæ•°æ®è¡¨æ ¼æ˜¾ç¤º -->
                                <div v-if="orderPaginationResult && orderPaginationResult.content && orderPaginationResult.content.length > 0" style="margin-top: 15px;">
                                    <h5>ğŸ“‹ è®¢å•åˆ—è¡¨ (å½“å‰é¡µæ•°æ®)</h5>
                                    <table class="data-table">
                                        <thead>
                                            <tr>
                                                <th>è®¢å•ID</th>
                                                <th>è®¢å•å·</th>
                                                <th>ç”¨æˆ·ID</th>
                                                <th>éƒ¨é—¨ID</th>
                                                <th>çŠ¶æ€</th>
                                                <th>åˆ›å»ºæ—¶é—´</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="order in orderPaginationResult.content" :key="order.orderId">
                                                <td>{{order.orderId}}</td>
                                                <td>{{order.orderNumber}}</td>
                                                <td>{{order.userId}}</td>
                                                <td>{{order.agenciesId}}</td>
                                                <td>
                                                    <span :style="{color: order.status === 1 ? 'green' : order.status === 0 ? 'orange' : 'red'}">
                                                        {{order.status === 1 ? 'å·²é€šè¿‡' : order.status === 0 ? 'å¾…å®¡æ ¸' : 'å·²æ‹’ç»'}}
                                                    </span>
                                                </td>
                                                <td>{{order.createDatetime}}</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <!-- åˆ†é¡µæŸ¥è¯¢å“åº”æ˜¾ç¤ºåŒºåŸŸ -->
                                <div class="response-area" :class="getResponseClass('orderPagination')" v-if="responses.orderPagination">
                                    {{ responses.orderPagination }}
                                </div>
                                <div class="response-area" :class="getResponseClass('orderUserPagination')" v-if="responses.orderUserPagination">
                                    {{ responses.orderUserPagination }}
                                </div>
                                <div class="response-area" :class="getResponseClass('orderStatusPagination')" v-if="responses.orderStatusPagination">
                                    {{ responses.orderStatusPagination }}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="function-group">
                        <div class="group-header">ğŸ“‹ è®¢å•CRUDæ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>æ™ºèƒ½è®¢å•åˆ›å»º</h4>
                                <div class="api-info">
                                    <strong>åŠŸèƒ½:</strong> è‡ªåŠ¨ä¿å­˜è‰ç¨¿ï¼Œæ”¯æŒæ–­ç‚¹ç»­ç¼–ï¼Œä¸€é”®æäº¤è®¢å•
                                </div>
                                <div class="form-row">
                                    <label>ç”¨æˆ·ID:</label>
                                    <input v-model="orderForm.userId" placeholder="USER001" />
                                    <label>éƒ¨é—¨ID:</label>
                                    <input v-model="orderForm.agenciesId" placeholder="DEPT001" />
                                </div>
                                <div v-if="currentDraft" class="form-row" style="background: #fff3cd; padding: 10px; border-radius: 5px; margin: 10px 0;">
                                    <span style="color: #856404;">ğŸ“ æ£€æµ‹åˆ°æœªå®Œæˆçš„è‰ç¨¿: {{ currentDraft.draftId }}</span>
                                    <div style="margin-top: 8px;">
                                        <button class="btn btn-info" style="margin-right: 10px;" @click="loadDraft">ğŸ“‚ åŠ è½½è‰ç¨¿</button>
                                        <small style="color: #666;">GET /api/orders/draft/{id}</small>
                                        <button class="btn btn-warning" style="margin-left: 15px; margin-right: 10px;" @click="clearDraft">ğŸ—‘ï¸ æ¸…é™¤è‰ç¨¿</button>
                                        <small style="color: #666;">DELETE /api/orders/draft/{id}</small>
                                    </div>
                                </div>
                                <div class="test-item">
                                    <h4>è®¢å•é¡¹é…ç½®</h4>
                                    <div class="form-row">
                                        <label>é¤ç¥¨ç±»å‹:</label>
                                        <select v-model="orderForm.selectedTypeId">
                                            <option value="">è¯·é€‰æ‹©é¤ç¥¨ç±»å‹</option>
                                            <option v-for="type in ticketTypes" :key="type.typeId" :value="type.typeId">
                                                {{ type.typeName }} ({{ type.typeId }}) - Â¥{{ type.value }}
                                            </option>
                                        </select>
                                        <label>æ•°é‡:</label>
                                        <input v-model="orderForm.selectedAmount" type="number" placeholder="5" min="1" max="100" />
                                        <button class="btn btn-success" @click="addOrderItem">â• æ·»åŠ </button>
                                        <small style="color: #666; margin-left: 10px;">è‡ªåŠ¨è§¦å‘: POST /api/orders/start</small>
                                    </div>
                                    <div v-if="orderForm.orderItemsList.length > 0" style="margin-top: 10px;">
                                        <strong>å·²æ·»åŠ çš„è®¢å•é¡¹:</strong>
                                        <div v-for="(item, index) in orderForm.orderItemsList" :key="index" class="order-item">
                                            <span class="order-item-text">{{ getTypeName(item.typeId) }} Ã— {{ item.amount }}</span>
                                            <button class="btn btn-danger btn-small" @click="removeOrderItem(index)">ğŸ—‘ï¸ åˆ é™¤</button>
                                            <small style="color: #666; margin-left: 5px;">è‡ªåŠ¨è§¦å‘: PUT /api/orders/draft/{id}/save</small>
                                        </div>
                                    </div>
                                    <div class="form-row" style="margin-top: 10px;">
                                        <label>JSONé¢„è§ˆ:</label>
                                        <textarea v-model="orderForm.orderItems" placeholder='[{"typeId":"TYPE001","amount":5}]' readonly style="background: #f8f9fa;"></textarea>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="saveDraftAndContinue">
                                            <span class="status-indicator" :class="getStatusClass('saveDraft')"></span>
                                            ğŸ’¾ ä¿å­˜è‰ç¨¿
                                        </button>
                                        <br><small style="color: #666;">POST /api/orders/start æˆ– PUT /api/orders/draft/{id}/save</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="createOrderFromDraft">
                                            <span class="status-indicator" :class="getStatusClass('createOrder')"></span>
                                            ğŸš€ æäº¤è®¢å•
                                        </button>
                                        <br><small style="color: #666;">POST /api/orders/draft/{id}/submit</small>
                                    </div>
                                    <div style="display: inline-block;" v-if="orderForm.orderItemsList.length > 0">
                                        <button class="btn btn-info" @click="autoSaveDraft">
                                            <span class="status-indicator" :class="getStatusClass('autoSave')"></span>
                                            âš¡ è‡ªåŠ¨ä¿å­˜
                                        </button>
                                        <br><small style="color: #666;">PUT /api/orders/draft/{id}/save</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('orderOperation')" v-if="responses.orderOperation">
                                    {{ responses.orderOperation }}
                                </div>
                            </div>

                            <div class="test-item">
                                <h4>è®¢å•æŸ¥è¯¢å’Œç®¡ç†</h4>
                                <div class="form-row">
                                    <label>è®¢å•ID:</label>
                                    <input v-model="orderQuery.orderId" placeholder="ORDER001" />
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="getOrderById">
                                            <span class="status-indicator" :class="getStatusClass('getOrder')"></span>
                                            æŸ¥è¯¢è®¢å•
                                        </button>
                                        <br><small style="color: #666;">GET /api/orders/{id}</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-info" @click="getOrderDetails">
                                            <span class="status-indicator" :class="getStatusClass('orderDetails')"></span>
                                            è¯¦ç»†ä¿¡æ¯
                                        </button>
                                        <br><small style="color: #666;">GET /api/orders/{id}/details</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-danger" @click="deleteOrder">
                                            <span class="status-indicator" :class="getStatusClass('deleteOrder')"></span>
                                            åˆ é™¤è®¢å•
                                        </button>
                                        <br><small style="color: #666;">DELETE /api/orders/{id}</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('orderQuery')" v-if="responses.orderQuery">
                                    {{ responses.orderQuery }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é¤ç¥¨ç®¡ç† -->
                <div class="tab-content" :class="{active: activeTab === 'tickets'}">
                    <div class="quick-actions">
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-info" @click="loadAllTickets">ğŸ“‹ åŠ è½½æ‰€æœ‰é¤ç¥¨</button>
                            <br><small style="color: #666;">GET /api/tickets/selectAll</small>
                        </div>
                        <div style="display: inline-block;">
                            <button class="btn btn-success" @click="clearForm('ticket')">ğŸ†• æ–°å»ºé¤ç¥¨</button>
                            <br><small style="color: #666;">æ¸…ç©ºè¡¨å•</small>
                        </div>
                    </div>
                    
                    <div class="function-group">
                        <div class="group-header">ğŸ« é¤ç¥¨CRUDæ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>æ‰¹é‡åˆ›å»ºé¤ç¥¨</h4>
                                <div class="api-info">
                                    <strong>æ¥å£:</strong> <code>POST /api/tickets/create</code> - æ‰¹é‡åˆ›å»ºé¤ç¥¨
                                </div>
                                <div class="form-row">
                                    <label>è®¢å•ID:</label>
                                    <input v-model="ticketForm.orderId" placeholder="ORDER001" />
                                    <label>é¤ç¥¨ç±»å‹:</label>
                                    <input v-model="ticketForm.typeId" placeholder="TYPE001" />
                                </div>
                                <div class="form-row">
                                    <label>æ•°é‡:</label>
                                    <input v-model="ticketForm.quantity" type="number" placeholder="10" />
                                    <label>æ¡£å£ID:</label>
                                    <input v-model="ticketForm.stallId" placeholder="STALL001" />
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block;">
                                        <button class="btn btn-success" @click="createTickets">
                                            <span class="status-indicator" :class="getStatusClass('createTickets')"></span>
                                            æ‰¹é‡åˆ›å»ºé¤ç¥¨
                                        </button>
                                        <br><small style="color: #666;">POST /api/tickets/create</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('ticketOperation')" v-if="responses.ticketOperation">
                                    {{ responses.ticketOperation }}
                                </div>
                            </div>

                            <div class="test-item">
                                <h4>é¤ç¥¨æŸ¥è¯¢å’Œæ ¸é”€</h4>
                                <div class="form-row">
                                    <label>é¤ç¥¨ID:</label>
                                    <input v-model="ticketQuery.ticketId" placeholder="TICKET001" />
                                    <div style="display: inline-block; margin-left: 10px;">
                                        <button class="btn btn-primary" @click="getTicketById">
                                            <span class="status-indicator" :class="getStatusClass('getTicket')"></span>
                                            æŸ¥è¯¢é¤ç¥¨
                                        </button>
                                        <br><small style="color: #666;">GET /api/tickets/{id}</small>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <label>æ ¸é”€äººID:</label>
                                    <input v-model="ticketQuery.checkId" placeholder="USER001" />
                                    <div style="display: inline-block; margin-left: 10px;">
                                        <button class="btn btn-warning" @click="cancelTicket">
                                            <span class="status-indicator" :class="getStatusClass('cancelTicket')"></span>
                                            æ ¸é”€é¤ç¥¨
                                        </button>
                                        <br><small style="color: #666;">POST /api/tickets/{id}/cancel</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('ticketQuery')" v-if="responses.ticketQuery">
                                    {{ responses.ticketQuery }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- éƒ¨é—¨ç®¡ç† -->
                <div class="tab-content" :class="{active: activeTab === 'agencies'}">
                    <div class="quick-actions">
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-info" @click="loadAllAgencies">ğŸ“‹ åŠ è½½æ‰€æœ‰éƒ¨é—¨</button>
                            <br><small style="color: #666;">GET /api/agencies</small>
                        </div>
                        <div style="display: inline-block;">
                            <button class="btn btn-success" @click="clearForm('agency')">ğŸ†• æ–°å»ºéƒ¨é—¨</button>
                            <br><small style="color: #666;">æ¸…ç©ºè¡¨å•</small>
                        </div>
                    </div>
                    
                    <div class="function-group">
                        <div class="group-header">ğŸ¢ éƒ¨é—¨CRUDæ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>éƒ¨é—¨ä¿¡æ¯ç®¡ç†</h4>
                                <div class="form-row">
                                    <label>éƒ¨é—¨ID:</label>
                                    <input v-model="agencyForm.agenciesId" placeholder="DEPT001" />
                                    <label>éƒ¨é—¨åç§°:</label>
                                    <input v-model="agencyForm.agenciesName" placeholder="æŠ€æœ¯éƒ¨" />
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="createAgency">
                                            <span class="status-indicator" :class="getStatusClass('createAgency')"></span>
                                            åˆ›å»ºéƒ¨é—¨
                                        </button>
                                        <br><small style="color: #666;">POST /api/agencies</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="getAgencyById">
                                            <span class="status-indicator" :class="getStatusClass('getAgency')"></span>
                                            æŸ¥è¯¢éƒ¨é—¨
                                        </button>
                                        <br><small style="color: #666;">GET /api/agencies/{id}</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-danger" @click="deleteAgency">
                                            <span class="status-indicator" :class="getStatusClass('deleteAgency')"></span>
                                            åˆ é™¤éƒ¨é—¨
                                        </button>
                                        <br><small style="color: #666;">DELETE /api/agencies/{id}</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('agencyOperation')" v-if="responses.agencyOperation">
                                    {{ responses.agencyOperation }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é£Ÿå ‚ç®¡ç† -->
                <div class="tab-content" :class="{active: activeTab === 'canteen'}">
                    <div class="quick-actions">
                        <div style="display: inline-block; margin-right: 15px;">
                            <button class="btn btn-info" @click="loadAllCanteens">ğŸ“‹ åŠ è½½æ‰€æœ‰é£Ÿå ‚</button>
                            <br><small style="color: #666;">GET /canteen</small>
                        </div>
                        <div style="display: inline-block;">
                            <button class="btn btn-success" @click="clearForm('canteen')">ğŸ†• æ–°å»ºé£Ÿå ‚</button>
                            <br><small style="color: #666;">æ¸…ç©ºè¡¨å•</small>
                        </div>
                    </div>
                    
                    <div class="function-group">
                        <div class="group-header">ğŸ½ï¸ é£Ÿå ‚CRUDæ“ä½œ</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>é£Ÿå ‚ä¿¡æ¯ç®¡ç†</h4>
                                <div class="form-row">
                                    <label>é£Ÿå ‚ID:</label>
                                    <input v-model="canteenForm.canteenId" placeholder="CANTEEN001" />
                                    <label>é£Ÿå ‚åç§°:</label>
                                    <input v-model="canteenForm.canteenName" placeholder="ç¬¬ä¸€é£Ÿå ‚" />
                                </div>
                                <div class="form-row">
                                    <label>çŠ¶æ€:</label>
                                    <select v-model="canteenForm.status">
                                        <option value="1">è¥ä¸š</option>
                                        <option value="0">åœä¸š</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="createCanteen">
                                            <span class="status-indicator" :class="getStatusClass('createCanteen')"></span>
                                            åˆ›å»ºé£Ÿå ‚
                                        </button>
                                        <br><small style="color: #666;">POST /canteen</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-primary" @click="getCanteenById">
                                            <span class="status-indicator" :class="getStatusClass('getCanteen')"></span>
                                            æŸ¥è¯¢é£Ÿå ‚
                                        </button>
                                        <br><small style="color: #666;">GET /canteen/{id}</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-warning" @click="updateCanteen">
                                            <span class="status-indicator" :class="getStatusClass('updateCanteen')"></span>
                                            æ›´æ–°é£Ÿå ‚
                                        </button>
                                        <br><small style="color: #666;">PUT /canteen</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('canteenOperation')" v-if="responses.canteenOperation">
                                    {{ responses.canteenOperation }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ç³»ç»ŸåŠŸèƒ½ -->
                <div class="tab-content" :class="{active: activeTab === 'system'}">
                    <div class="function-group">
                        <div class="group-header">âš™ï¸ ç³»ç»ŸåŠŸèƒ½æµ‹è¯•</div>
                        <div class="group-body">
                            <div class="test-item">
                                <h4>æ•°æ®åº“è¿æ¥æµ‹è¯•</h4>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="testDatabaseHealth">
                                            <span class="status-indicator" :class="getStatusClass('dbHealth')"></span>
                                            å¥åº·æ£€æŸ¥
                                        </button>
                                        <br><small style="color: #666;">GET /api/database-test/health</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-info" @click="testDatabaseConnection">
                                            <span class="status-indicator" :class="getStatusClass('dbConnection')"></span>
                                            è¿æ¥æµ‹è¯•
                                        </button>
                                        <br><small style="color: #666;">GET /api/database-test/connection</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-primary" @click="getDatabaseInfo">
                                            <span class="status-indicator" :class="getStatusClass('dbInfo')"></span>
                                            æ•°æ®åº“ä¿¡æ¯
                                        </button>
                                        <br><small style="color: #666;">GET /api/database-test/info</small>
                                    </div>
                                </div>
                                <div class="response-area" :class="getResponseClass('systemOperation')" v-if="responses.systemOperation">
                                    {{ responses.systemOperation }}
                                </div>
                            </div>

                            <div class="test-item">
                                <h4>æ‰¹é‡æµ‹è¯•åŠŸèƒ½</h4>
                                <div class="form-row">
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-success" @click="testAllBasicFunctions">
                                            ğŸš€ æµ‹è¯•æ‰€æœ‰åŸºç¡€åŠŸèƒ½
                                        </button>
                                        <br><small style="color: #666;">æ‰¹é‡è°ƒç”¨å¤šä¸ªAPI</small>
                                    </div>
                                    <div style="display: inline-block; margin-right: 15px;">
                                        <button class="btn btn-info" @click="testAllCRUDFunctions">
                                            âœ¨ æµ‹è¯•æ‰€æœ‰CRUDåŠŸèƒ½
                                        </button>
                                        <br><small style="color: #666;">æ‰¹é‡æµ‹è¯•å¢åˆ æ”¹æŸ¥</small>
                                    </div>
                                    <div style="display: inline-block;">
                                        <button class="btn btn-warning" @click="clearAllResponses">
                                            ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰ç»“æœ
                                        </button>
                                        <br><small style="color: #666;">æ¸…ç©ºç•Œé¢å“åº”</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    baseURL: 'http://localhost:8080/api',
                    activeTab: 'users',
                    responses: {},
                    loading: {},
                    
                    // ç”¨æˆ·è¡¨å•
                    userForm: {
                        userId: 'USER009',
                        userName: 'testuser',
                        roleId: 'ROLE001',
                        agenciesId: 'DEPT001',
                        fullName: 'æµ‹è¯•ç”¨æˆ·',
                        password: '123456',
                        status: 1,
                        phoneNumber: '13900139000'
                    },

                    // ç”¨æˆ·é€‰æ‹©ç›¸å…³
                    userList: [],
                    selectedUserId: '',
                    selectedUserInfo: null,
                    
                    // è®¢å•è¡¨å•
                    orderForm: {
                        userId: 'USER001',
                        agenciesId: 'DEPT001',
                        selectedTypeId: '',
                        selectedAmount: 5,
                        orderItemsList: []
                    },

                    // è®¢å•åˆ†é¡µå‚æ•°
                    orderPagination: {
                        page: 0,
                        size: 10,
                        sortBy: 'createDatetime',
                        sortDir: 'desc'
                    },
                    orderPaginationResult: null,

                    // é¤ç¥¨ç±»å‹åˆ—è¡¨
                    ticketTypes: [],

                    // å½“å‰è‰ç¨¿ä¿¡æ¯
                    currentDraft: null,

                    // è‡ªåŠ¨ä¿å­˜å®šæ—¶å™¨
                    autoSaveTimer: null,
                    
                    // è®¢å•æŸ¥è¯¢
                    orderQuery: {
                        orderId: 'ORDER001',
                        status: 0  // 0=å¾…å®¡æ ¸ï¼Œ1=å·²é€šè¿‡ï¼Œ-1=å·²æ‹’ç»
                    },
                    
                    // é¤ç¥¨è¡¨å•
                    ticketForm: {
                        orderId: 'ORDER001',
                        typeId: 'TYPE001',
                        quantity: 10,
                        stallId: 'STALL001'
                    },
                    
                    // é¤ç¥¨æŸ¥è¯¢
                    ticketQuery: {
                        ticketId: 'TICKET001',
                        checkId: 'USER001'
                    },
                    
                    // éƒ¨é—¨è¡¨å•
                    agencyForm: {
                        agenciesId: 'DEPT004',
                        agenciesName: 'æµ‹è¯•éƒ¨é—¨'
                    },
                    
                    // é£Ÿå ‚è¡¨å•
                    canteenForm: {
                        canteenId: 'CANTEEN004',
                        canteenName: 'æµ‹è¯•é£Ÿå ‚',
                        status: '1'
                    }
                }
            },
            methods: {
                async makeRequest(method, url, data, key) {
                    this.loading[key] = true;
                    this.responses[key] = 'è¯·æ±‚ä¸­...';
                    
                    try {
                        let response;
                        if (method === 'GET') {
                            response = await axios.get(url);
                        } else if (method === 'POST') {
                            response = await axios.post(url, data);
                        } else if (method === 'PUT') {
                            response = await axios.put(url, data);
                        } else if (method === 'DELETE') {
                            response = await axios.delete(url);
                        }
                        
                        this.responses[key] = JSON.stringify(response.data, null, 2);
                        this.loading[key] = false;
                    } catch (error) {
                        this.responses[key] = `è¯·æ±‚å¤±è´¥:\n${error.message}\n\nå“åº”è¯¦æƒ…:\n${error.response ? JSON.stringify(error.response.data, null, 2) : 'æ— å“åº”æ•°æ®'}`;
                        this.loading[key] = 'error';
                    }
                },

                // ç”¨æˆ·ç®¡ç†æ–¹æ³•
                async createUser() {
                    await this.makeRequest('POST', `${this.baseURL}/users`, this.userForm, 'userOperation');
                },
                
                async getUserById() {
                    await this.makeRequest('GET', `${this.baseURL}/users/${this.userForm.userId}`, null, 'userOperation');
                },
                
                async deleteUser() {
                    await this.makeRequest('DELETE', `${this.baseURL}/users/${this.userForm.userId}`, null, 'userOperation');
                },
                
                async getUserStatistics() {
                    await this.makeRequest('GET', `${this.baseURL}/users/${this.userForm.userId}/statistics`, null, 'userOperation');
                },
                
                async loadAllUsers() {
                    await this.makeRequest('GET', `${this.baseURL}/users`, null, 'userOperation');
                    // åŒæ—¶æ›´æ–°ç”¨æˆ·åˆ—è¡¨
                    await this.refreshUserList();
                },

                // ç”¨æˆ·é€‰æ‹©ç›¸å…³æ–¹æ³•
                async refreshUserList() {
                    try {
                        const response = await axios.get(`${this.baseURL}/users`);
                        if (response.data && Array.isArray(response.data)) {
                            this.userList = response.data;
                        }
                    } catch (error) {
                        console.error('åˆ·æ–°ç”¨æˆ·åˆ—è¡¨å¤±è´¥:', error);
                    }
                },

                onUserSelect() {
                    if (this.selectedUserId) {
                        this.selectedUserInfo = this.userList.find(user => user.userId === this.selectedUserId);
                        // åŒæ—¶æ›´æ–°è¡¨å•ä¸­çš„ç”¨æˆ·IDï¼Œæ–¹ä¾¿åŸæœ‰åŠŸèƒ½ä½¿ç”¨
                        this.userForm.userId = this.selectedUserId;
                    } else {
                        this.selectedUserInfo = null;
                    }
                },

                async getUserBySelectedId() {
                    if (!this.selectedUserId) {
                        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”¨æˆ·');
                        return;
                    }
                    await this.makeRequest('GET', `${this.baseURL}/users/${this.selectedUserId}`, null, 'userOperation');
                },

                async deleteSelectedUser() {
                    if (!this.selectedUserId) {
                        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”¨æˆ·');
                        return;
                    }
                    if (confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· ${this.selectedUserId} å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                        await this.makeRequest('DELETE', `${this.baseURL}/users/${this.selectedUserId}`, null, 'userOperation');
                        // åˆ é™¤æˆåŠŸååˆ·æ–°ç”¨æˆ·åˆ—è¡¨
                        setTimeout(() => {
                            this.refreshUserList();
                            this.selectedUserId = '';
                            this.selectedUserInfo = null;
                        }, 1000);
                    }
                },

                async getSelectedUserStatistics() {
                    if (!this.selectedUserId) {
                        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç”¨æˆ·');
                        return;
                    }
                    await this.makeRequest('GET', `${this.baseURL}/users/${this.selectedUserId}/statistics`, null, 'userOperation');
                },

                // è®¢å•ç®¡ç†æ–¹æ³• - æ•´åˆè‰ç¨¿åŠŸèƒ½
                async saveDraftAndContinue() {
                    if (this.orderForm.orderItemsList.length === 0) {
                        alert('è¯·å…ˆæ·»åŠ è®¢å•é¡¹');
                        return;
                    }

                    try {
                        let draftData;

                        if (this.currentDraft) {
                            // æ›´æ–°ç°æœ‰è‰ç¨¿
                            draftData = {
                                orderItems: this.orderForm.orderItemsList
                            };
                            await this.makeRequest('PUT', `${this.baseURL}/orders/draft/${this.currentDraft.draftId}/save`, draftData, 'orderOperation');
                        } else {
                            // åˆ›å»ºæ–°è‰ç¨¿
                            draftData = {
                                userId: this.orderForm.userId,
                                agenciesId: this.orderForm.agenciesId,
                                orderItems: this.orderForm.orderItemsList
                            };
                            const response = await axios.post(`${this.baseURL}/orders/start`, draftData);
                            if (response.data.code === '200') {
                                this.currentDraft = response.data.data;
                                this.responses.orderOperation = JSON.stringify(response.data, null, 2);
                                this.loading.saveDraft = false;
                            }
                        }

                        // å¯åŠ¨è‡ªåŠ¨ä¿å­˜
                        this.startAutoSave();

                    } catch (error) {
                        this.responses.orderOperation = `ä¿å­˜è‰ç¨¿å¤±è´¥:\n${error.message}`;
                        this.loading.saveDraft = 'error';
                    }
                },

                async createOrderFromDraft() {
                    if (!this.currentDraft) {
                        // å¦‚æœæ²¡æœ‰è‰ç¨¿ï¼Œå…ˆåˆ›å»ºè‰ç¨¿å†æäº¤
                        await this.saveDraftAndContinue();
                        if (!this.currentDraft) return;
                    }

                    // æäº¤è‰ç¨¿ä¸ºæ­£å¼è®¢å•
                    await this.makeRequest('POST', `${this.baseURL}/orders/draft/${this.currentDraft.draftId}/submit`, null, 'orderOperation');

                    // æ¸…é™¤è‰ç¨¿çŠ¶æ€
                    this.currentDraft = null;
                    this.stopAutoSave();
                },

                async autoSaveDraft() {
                    if (this.currentDraft && this.orderForm.orderItemsList.length > 0) {
                        try {
                            const draftData = {
                                orderItems: this.orderForm.orderItemsList
                            };
                            await axios.put(`${this.baseURL}/orders/draft/${this.currentDraft.draftId}/save`, draftData);
                            this.loading.autoSave = false;

                            // æ˜¾ç¤ºè‡ªåŠ¨ä¿å­˜æˆåŠŸæç¤º
                            setTimeout(() => {
                                this.loading.autoSave = null;
                            }, 1000);
                        } catch (error) {
                            this.loading.autoSave = 'error';
                        }
                    }
                },
                
                async getOrderById() {
                    await this.makeRequest('GET', `${this.baseURL}/orders/${this.orderQuery.orderId}`, null, 'orderQuery');
                },
                
                async getOrderDetails() {
                    await this.makeRequest('GET', `${this.baseURL}/orders/${this.orderQuery.orderId}/details`, null, 'orderQuery');
                },
                
                async deleteOrder() {
                    await this.makeRequest('DELETE', `${this.baseURL}/orders/${this.orderQuery.orderId}`, null, 'orderQuery');
                },
                
                async loadAllOrders() {
                    await this.makeRequest('GET', `${this.baseURL}/orders`, null, 'orderOperation');
                },

                // åˆ†é¡µæŸ¥è¯¢æ–¹æ³•
                async loadOrdersWithPagination() {
                    const params = new URLSearchParams({
                        page: this.orderPagination.page.toString(),
                        size: this.orderPagination.size.toString(),
                        sortBy: this.orderPagination.sortBy,
                        sortDir: this.orderPagination.sortDir
                    });

                    try {
                        this.loading.orderPagination = true;
                        const response = await axios.get(`${this.baseURL}/orders/page?${params}`);

                        console.log('åˆ†é¡µæŸ¥è¯¢å“åº”:', response.data); // è°ƒè¯•æ—¥å¿—

                        if (response.data.code === '200') {
                            this.orderPaginationResult = response.data.data;
                            this.responses.orderPagination = JSON.stringify(response.data, null, 2);
                            this.loading.orderPagination = false;

                            // è°ƒè¯•åˆ†é¡µç»“æœ
                            console.log('åˆ†é¡µç»“æœ:', this.orderPaginationResult);
                            console.log('åˆ†é¡µä¿¡æ¯:', {
                                page: this.orderPaginationResult.page,
                                size: this.orderPaginationResult.size,
                                totalElements: this.orderPaginationResult.totalElements,
                                totalPages: this.orderPaginationResult.totalPages,
                                first: this.orderPaginationResult.first,
                                last: this.orderPaginationResult.last
                            });
                        } else {
                            throw new Error(response.data.msg || 'åˆ†é¡µæŸ¥è¯¢å¤±è´¥');
                        }
                    } catch (error) {
                        console.error('åˆ†é¡µæŸ¥è¯¢é”™è¯¯:', error);
                        this.responses.orderPagination = `åˆ†é¡µæŸ¥è¯¢å¤±è´¥:\n${error.message}\n\nå“åº”è¯¦æƒ…:\n${error.response ? JSON.stringify(error.response.data, null, 2) : 'æ— å“åº”æ•°æ®'}`;
                        this.loading.orderPagination = 'error';
                    }
                },

                async loadOrdersByUserWithPagination() {
                    if (!this.orderForm.userId) {
                        alert('è¯·å…ˆå¡«å†™ç”¨æˆ·ID');
                        return;
                    }

                    const params = new URLSearchParams({
                        page: this.orderPagination.page.toString(),
                        size: this.orderPagination.size.toString(),
                        sortBy: this.orderPagination.sortBy,
                        sortDir: this.orderPagination.sortDir
                    });

                    try {
                        this.loading.orderUserPagination = true;
                        const response = await axios.get(`${this.baseURL}/orders/page/user/${this.orderForm.userId}?${params}`);

                        if (response.data.code === '200') {
                            this.orderPaginationResult = response.data.data;
                            this.responses.orderUserPagination = JSON.stringify(response.data, null, 2);
                            this.loading.orderUserPagination = false;
                        } else {
                            throw new Error(response.data.msg || 'ç”¨æˆ·è®¢å•åˆ†é¡µæŸ¥è¯¢å¤±è´¥');
                        }
                    } catch (error) {
                        this.responses.orderUserPagination = `ç”¨æˆ·è®¢å•åˆ†é¡µæŸ¥è¯¢å¤±è´¥:\n${error.message}\n\nå“åº”è¯¦æƒ…:\n${error.response ? JSON.stringify(error.response.data, null, 2) : 'æ— å“åº”æ•°æ®'}`;
                        this.loading.orderUserPagination = 'error';
                    }
                },

                async loadOrdersByStatusWithPagination() {
                    if (this.orderQuery.status === undefined || this.orderQuery.status === '') {
                        alert('è¯·å…ˆè®¾ç½®è®¢å•çŠ¶æ€');
                        return;
                    }

                    const params = new URLSearchParams({
                        page: this.orderPagination.page.toString(),
                        size: this.orderPagination.size.toString(),
                        sortBy: this.orderPagination.sortBy,
                        sortDir: this.orderPagination.sortDir
                    });

                    try {
                        this.loading.orderStatusPagination = true;
                        const response = await axios.get(`${this.baseURL}/orders/page/status/${this.orderQuery.status}?${params}`);

                        if (response.data.code === '200') {
                            this.orderPaginationResult = response.data.data;
                            this.responses.orderStatusPagination = JSON.stringify(response.data, null, 2);
                            this.loading.orderStatusPagination = false;
                        } else {
                            throw new Error(response.data.msg || 'çŠ¶æ€è®¢å•åˆ†é¡µæŸ¥è¯¢å¤±è´¥');
                        }
                    } catch (error) {
                        this.responses.orderStatusPagination = `çŠ¶æ€è®¢å•åˆ†é¡µæŸ¥è¯¢å¤±è´¥:\n${error.message}\n\nå“åº”è¯¦æƒ…:\n${error.response ? JSON.stringify(error.response.data, null, 2) : 'æ— å“åº”æ•°æ®'}`;
                        this.loading.orderStatusPagination = 'error';
                    }
                },

                // åˆ†é¡µå¯¼èˆªæ–¹æ³•
                previousPage() {
                    if (this.orderPaginationResult && !this.orderPaginationResult.first) {
                        this.orderPagination.page = this.orderPaginationResult.page - 1;
                        this.loadOrdersWithPagination();
                    }
                },

                nextPage() {
                    if (this.orderPaginationResult && !this.orderPaginationResult.last) {
                        this.orderPagination.page = this.orderPaginationResult.page + 1;
                        this.loadOrdersWithPagination();
                    }
                },

                // é¤ç¥¨ç®¡ç†æ–¹æ³•
                async createTickets() {
                    const ticketData = {
                        orderId: this.ticketForm.orderId,
                        typeId: this.ticketForm.typeId,
                        quantity: parseInt(this.ticketForm.quantity),
                        stallId: this.ticketForm.stallId
                    };
                    await this.makeRequest('POST', `${this.baseURL}/tickets/create`, ticketData, 'ticketOperation');
                },
                
                async getTicketById() {
                    await this.makeRequest('GET', `${this.baseURL}/tickets/${this.ticketQuery.ticketId}`, null, 'ticketQuery');
                },
                
                async cancelTicket() {
                    await this.makeRequest('POST', `${this.baseURL}/tickets/${this.ticketQuery.ticketId}/cancel?checkId=${this.ticketQuery.checkId}`, null, 'ticketQuery');
                },
                
                async loadAllTickets() {
                    await this.makeRequest('GET', `${this.baseURL}/tickets/selectAll`, null, 'ticketOperation');
                },

                // éƒ¨é—¨ç®¡ç†æ–¹æ³•
                async createAgency() {
                    // æ„å»ºå®Œæ•´çš„éƒ¨é—¨æ•°æ®ï¼ŒåŒ…å«æ‰€æœ‰å¿…å¡«å­—æ®µ
                    const agencyData = {
                        agenciesId: this.agencyForm.agenciesId,
                        agenciesName: this.agencyForm.agenciesName,
                        status: 1, // é»˜è®¤å¯ç”¨çŠ¶æ€
                        fkCreator: 'system', // åˆ›å»ºè€…
                        createDatetime: new Date().toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', ''), // æ ¼å¼: yyyyMMddHHmmss
                        createIP: '127.0.0.1' // åˆ›å»ºIP
                    };

                    await this.makeRequest('POST', `${this.baseURL}/agencies`, agencyData, 'agencyOperation');
                },
                
                async getAgencyById() {
                    await this.makeRequest('GET', `${this.baseURL}/agencies/${this.agencyForm.agenciesId}`, null, 'agencyOperation');
                },
                
                async deleteAgency() {
                    await this.makeRequest('DELETE', `${this.baseURL}/agencies/${this.agencyForm.agenciesId}`, null, 'agencyOperation');
                },
                
                async loadAllAgencies() {
                    await this.makeRequest('GET', `${this.baseURL}/agencies`, null, 'agencyOperation');
                },

                // é£Ÿå ‚ç®¡ç†æ–¹æ³•
                async createCanteen() {
                    // æ„å»ºå®Œæ•´çš„é£Ÿå ‚æ•°æ®ï¼ŒåŒ…å«æ‰€æœ‰å¿…å¡«å­—æ®µ
                    const canteenData = {
                        canteenId: this.canteenForm.canteenId,
                        canteenName: this.canteenForm.canteenName,
                        status: parseInt(this.canteenForm.status),
                        fkCreator: 'system',
                        createDatetime: new Date().toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', ''),
                        createIp: '127.0.0.1'  // æ³¨æ„ï¼šå­—æ®µåæ˜¯createIpï¼Œä¸æ˜¯createIP
                    };

                    console.log('åˆ›å»ºé£Ÿå ‚æ•°æ®:', canteenData); // è°ƒè¯•æ—¥å¿—
                    await this.makeRequest('POST', `${this.baseURL}/canteen`, canteenData, 'canteenOperation');
                },
                
                async getCanteenById() {
                    await this.makeRequest('GET', `${this.baseURL}/canteen/${this.canteenForm.canteenId}`, null, 'canteenOperation');
                },
                
                async updateCanteen() {
                    // æ„å»ºå®Œæ•´çš„é£Ÿå ‚æ›´æ–°æ•°æ®
                    const canteenData = {
                        canteenId: this.canteenForm.canteenId,
                        canteenName: this.canteenForm.canteenName,
                        status: parseInt(this.canteenForm.status),
                        fkCreator: 'system', // ä¿æŒåŸåˆ›å»ºè€…æˆ–ä½¿ç”¨å½“å‰ç”¨æˆ·
                        createDatetime: new Date().toISOString().slice(0, 19).replace(/[-:]/g, '').replace('T', ''),
                        createIp: '127.0.0.1'
                    };

                    console.log('æ›´æ–°é£Ÿå ‚æ•°æ®:', canteenData); // è°ƒè¯•æ—¥å¿—
                    await this.makeRequest('PUT', `${this.baseURL}/canteen`, canteenData, 'canteenOperation');
                },
                
                async deleteCanteen() {
                    await this.makeRequest('DELETE', `${this.baseURL}/canteen/${this.canteenForm.canteenId}`, null, 'canteenOperation');
                },

                async loadAllCanteens() {
                    await this.makeRequest('GET', `${this.baseURL}/canteen`, null, 'canteenOperation');
                },

                // ç³»ç»ŸåŠŸèƒ½æ–¹æ³•
                async testDatabaseHealth() {
                    await this.makeRequest('GET', `${this.baseURL}/database-test/health`, null, 'systemOperation');
                },
                
                async testDatabaseConnection() {
                    await this.makeRequest('GET', `${this.baseURL}/database-test/connection`, null, 'systemOperation');
                },
                
                async getDatabaseInfo() {
                    await this.makeRequest('GET', `${this.baseURL}/database-test/info`, null, 'systemOperation');
                },

                // å·¥å…·æ–¹æ³•
                getStatusClass(key) {
                    if (this.loading[key] === true) return 'status-loading';
                    if (this.loading[key] === 'error') return 'status-error';
                    if (this.responses[key] && this.loading[key] === false) return 'status-success';
                    return '';
                },

                getResponseClass(key) {
                    if (this.loading[key] === true) return 'loading';
                    if (this.loading[key] === 'error') return 'error';
                    if (this.responses[key] && this.loading[key] === false) return 'success';
                    return '';
                },

                clearForm(type) {
                    switch(type) {
                        case 'user':
                            this.userForm = {
                                userId: '',
                                userName: '',
                                roleId: 'ROLE001',
                                agenciesId: 'DEPT001',
                                fullName: '',
                                password: '123456',
                                status: 1,
                                phoneNumber: ''
                            };
                            break;
                        case 'order':
                            this.orderForm = {
                                userId: 'USER001',
                                agenciesId: 'DEPT001',
                                selectedTypeId: '',
                                selectedAmount: 5,
                                orderItemsList: []
                            };
                            this.currentDraft = null;
                            this.stopAutoSave();
                            break;
                        case 'ticket':
                            this.ticketForm = {
                                orderId: '',
                                typeId: 'TYPE001',
                                quantity: 10,
                                stallId: 'STALL001'
                            };
                            break;
                        case 'agency':
                            this.agencyForm = {
                                agenciesId: '',
                                agenciesName: ''
                            };
                            break;
                        case 'canteen':
                            this.canteenForm = {
                                canteenId: '',
                                canteenName: '',
                                status: '1'
                            };
                            break;
                    }
                },

                async testAllBasicFunctions() {
                    await this.testDatabaseHealth();
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await this.getUserById();
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await this.getOrderById();
                    await new Promise(resolve => setTimeout(resolve, 500));
                    await this.getTicketById();
                },

                async testAllCRUDFunctions() {
                    // æµ‹è¯•ç”¨æˆ·CRUD
                    this.userForm.userId = 'TEST001';
                    this.userForm.userName = 'testuser';
                    this.userForm.fullName = 'æµ‹è¯•ç”¨æˆ·';
                    await this.createUser();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await this.getUserById();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    await this.deleteUser();
                },

                clearAllResponses() {
                    this.responses = {};
                    this.loading = {};
                },

                // è®¢å•é¡¹ç®¡ç†æ–¹æ³•
                addOrderItem() {
                    if (!this.orderForm.selectedTypeId) {
                        alert('è¯·é€‰æ‹©é¤ç¥¨ç±»å‹');
                        return;
                    }
                    if (!this.orderForm.selectedAmount || this.orderForm.selectedAmount <= 0) {
                        alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡');
                        return;
                    }

                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒç±»å‹
                    const existingIndex = this.orderForm.orderItemsList.findIndex(
                        item => item.typeId === this.orderForm.selectedTypeId
                    );

                    if (existingIndex >= 0) {
                        // å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–°æ•°é‡
                        this.orderForm.orderItemsList[existingIndex].amount = parseInt(this.orderForm.selectedAmount);
                    } else {
                        // æ·»åŠ æ–°é¡¹
                        this.orderForm.orderItemsList.push({
                            typeId: this.orderForm.selectedTypeId,
                            amount: parseInt(this.orderForm.selectedAmount)
                        });
                    }

                    // æ›´æ–°JSONå­—ç¬¦ä¸²
                    this.updateOrderItemsJson();

                    // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªè®¢å•é¡¹ï¼Œè‡ªåŠ¨åˆ›å»ºè‰ç¨¿
                    if (this.orderForm.orderItemsList.length === 1 && !this.currentDraft) {
                        setTimeout(() => {
                            this.saveDraftAndContinue();
                        }, 500);
                    }

                    // æ¸…ç©ºé€‰æ‹©
                    this.orderForm.selectedTypeId = '';
                    this.orderForm.selectedAmount = 5;
                },

                removeOrderItem(index) {
                    this.orderForm.orderItemsList.splice(index, 1);
                    this.updateOrderItemsJson();
                },

                updateOrderItemsJson() {
                    this.orderForm.orderItems = JSON.stringify(this.orderForm.orderItemsList);
                },

                getTypeName(typeId) {
                    const type = this.ticketTypes.find(t => t.typeId === typeId);
                    return type ? `${type.typeName} (Â¥${type.value})` : typeId;
                },

                // åŠ è½½é¤ç¥¨ç±»å‹
                async loadTicketTypes() {
                    try {
                        const response = await axios.get(`${this.baseURL}/ticket-types`);
                        if (response.data.code === '200') {
                            this.ticketTypes = response.data.data;
                        }
                    } catch (error) {
                        console.error('åŠ è½½é¤ç¥¨ç±»å‹å¤±è´¥:', error);
                    }
                },

                // è‰ç¨¿ç®¡ç†åŠŸèƒ½
                async checkExistingDraft() {
                    try {
                        const response = await axios.get(`${this.baseURL}/orders/drafts/current/${this.orderForm.userId}`);
                        if (response.data.code === '200' && response.data.data) {
                            // æ‰¾åˆ°å½“å‰æœªå®Œæˆçš„è‰ç¨¿
                            this.currentDraft = response.data.data;
                        }
                    } catch (error) {
                        console.log('æ²¡æœ‰æ‰¾åˆ°ç°æœ‰è‰ç¨¿');
                    }
                },

                async loadDraft() {
                    if (!this.currentDraft) return;

                    try {
                        const response = await axios.get(`${this.baseURL}/orders/draft/${this.currentDraft.draftId}`);
                        if (response.data.code === '200') {
                            const draftData = response.data.data;

                            // åŠ è½½è‰ç¨¿æ•°æ®åˆ°è¡¨å•
                            this.orderForm.userId = draftData.userId;
                            this.orderForm.agenciesId = draftData.agenciesId;

                            // åŠ è½½è®¢å•é¡¹
                            if (draftData.orderItems && draftData.orderItems.length > 0) {
                                this.orderForm.orderItemsList = draftData.orderItems;
                                this.updateOrderItemsJson();
                            }

                            // å¯åŠ¨è‡ªåŠ¨ä¿å­˜
                            this.startAutoSave();

                            alert('è‰ç¨¿åŠ è½½æˆåŠŸï¼');
                        }
                    } catch (error) {
                        alert('åŠ è½½è‰ç¨¿å¤±è´¥: ' + error.message);
                    }
                },

                async clearDraft() {
                    if (!this.currentDraft) return;

                    if (confirm('ç¡®å®šè¦æ¸…é™¤å½“å‰è‰ç¨¿å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                        try {
                            await axios.delete(`${this.baseURL}/orders/draft/${this.currentDraft.draftId}`);
                            this.currentDraft = null;
                            this.stopAutoSave();

                            // æ¸…ç©ºè¡¨å•
                            this.orderForm.orderItemsList = [];
                            this.updateOrderItemsJson();

                            alert('è‰ç¨¿å·²æ¸…é™¤');
                        } catch (error) {
                            alert('æ¸…é™¤è‰ç¨¿å¤±è´¥: ' + error.message);
                        }
                    }
                },

                // è‡ªåŠ¨ä¿å­˜åŠŸèƒ½
                startAutoSave() {
                    this.stopAutoSave(); // å…ˆåœæ­¢ç°æœ‰çš„å®šæ—¶å™¨

                    this.autoSaveTimer = setInterval(() => {
                        if (this.currentDraft && this.orderForm.orderItemsList.length > 0) {
                            this.autoSaveDraft();
                        }
                    }, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
                },

                stopAutoSave() {
                    if (this.autoSaveTimer) {
                        clearInterval(this.autoSaveTimer);
                        this.autoSaveTimer = null;
                    }
                }
            },

            // ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
            async mounted() {
                await this.loadTicketTypes();
                await this.checkExistingDraft();
                await this.refreshUserList(); // åˆå§‹åŒ–ç”¨æˆ·åˆ—è¡¨
            },

            // ç›‘å¬è®¢å•é¡¹å˜åŒ–ï¼Œè‡ªåŠ¨è§¦å‘ä¿å­˜
            watch: {
                'orderForm.orderItemsList': {
                    handler(newItems) {
                        this.updateOrderItemsJson();

                        // å¦‚æœæœ‰è‰ç¨¿ä¸”æœ‰è®¢å•é¡¹ï¼Œå»¶è¿Ÿè‡ªåŠ¨ä¿å­˜
                        if (this.currentDraft && newItems.length > 0) {
                            clearTimeout(this.delayedSaveTimer);
                            this.delayedSaveTimer = setTimeout(() => {
                                this.autoSaveDraft();
                            }, 2000); // 2ç§’åè‡ªåŠ¨ä¿å­˜
                        }
                    },
                    deep: true
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
